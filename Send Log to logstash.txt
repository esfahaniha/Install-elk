#!/bin/bash

LOG_FILE="/path/to/your/logfile.log"
LOGSTASH_URL="http://192.168.11.130:5044"
LAST_LINE_FILE="/path/to/last_line.txt"

if [ ! -f "$LAST_LINE_FILE" ]; then
  echo "0" > "$LAST_LINE_FILE"
fi

LAST_LINE=$(cat "$LAST_LINE_FILE")

NEW_LINES=$(tail -n +$((LAST_LINE + 1)) "$LOG_FILE")

if [ -n "$NEW_LINES" ]; then
  HOSTNAME=$(hostname)
  echo "$NEW_LINES" | while read line; do
    curl -X POST "$LOGSTASH_URL" -H "Content-Type: application/json" -d'
    {
      "@timestamp": "'$(date --utc +%Y-%m-%dT%H:%M:%S.%3NZ)'",
      "log": "'"$line"'",
      "host": "'"$HOSTNAME"'",
      "application": "your_application_name",
      "level": "info"
    }'
  done
  
  NEW_LAST_LINE=$(wc -l < "$LOG_FILE")
  echo "$NEW_LAST_LINE" > "$LAST_LINE_FILE"
fi
